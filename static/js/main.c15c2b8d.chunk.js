(this.webpackJsonpbrush=this.webpackJsonpbrush||[]).push([[0],{136:function(e,t,a){},137:function(e,t,a){},139:function(e,t,a){},143:function(e,t,a){"use strict";a.r(t);var i=a(1),s=a.n(i),r=a(34),n=a.n(r),c=(a(136),a(3)),o=a(153),l=a(5),h=function(e){};h.selectedRows=[],h.deselectAll=function(){h.selectedRows=[]},h.getColumnNames=function(){return["A","B","A * B","sin( A / B )"]},h.getDomain=function(e,t){return[l.d(h.getValues(e),(function(e){return e[t]})),l.c(h.getValues(e),(function(e){return e[t]}))]},h.values=[],h.getValues=function(e){if(h.values.length!==e){var t=l.e(0,.5);h.values=[];for(var a=0;a<e;a++){var i=t(),s=t();h.values[a]=[i,s,i*s,0===s?0:Math.sin(i/s)]}}return h.values};var d=h,u=function(e){};u.draw=function(e,t,a,i,s,r,n){var c=s.getContext("2d"),o=d.getColumnNames();c.fillStyle="#000000",c.font="14px Verdana";var l=o[n];c.fillText(l,e+a/2-c.measureText(l).width/2,t+i-i/2+4),c.font="12px Verdana",l=""+Math.round(10*d.getDomain(r,n)[0])/10,c.fillText(l,e+4,t+i-4),l=""+Math.round(10*d.getDomain(r,n)[1])/10,c.fillText(l,e+a-3-c.measureText(l).width,t+12)};var b=u,f=function(e){};f.padding=10,f.imageData=void 0,f.normalize=function(e){var t=e.x,a=e.y,i=e.width,s=e.height;return i<0&&(t+=i,i=-i),s<0&&(a+=s,s=-s),{x:t,y:a,width:i,height:s}},f.isWithin=function(e,t,a){var i=f.normalize(t);return void 0!==a&&(i.x-=a,i.y-=a,i.width+=2*a,i.height+=2*a),i.x<=e.x&&e.x<i.x+i.width&&i.y<=e.y&&e.y<i.y+i.height},f.draw=function(e,t,a,i,s,r,n,c,o,l,h){var u=c.getContext("2d"),b=f.padding,p=n[s],j=n[r],g=p.length,m=d.getValues(g),v=a*i*4,x=h;if(void 0===x){var w=(x=u.createImageData(a,i)).data;m.forEach((function(e,t){var s=p[t],r=4*((i-j[t])*a+s);0<=r&&r+3<v&&(w[r]=Math.round(0+w[r]*(1-o)),w[r+1]=Math.round(0+w[r+1]*(1-o)),w[r+2]=Math.round(0+w[r+2]*(1-o)),w[r+3]=Math.round(255*o+w[r+3]*(1-o)))}))}f.imageData&&f.imageData.data.length===v?f.imageData.data.fill(0,0,v):f.imageData=u.createImageData(a,i);var O=f.imageData,y=O.data;y.set(x.data);for(var D=0;D<l.length;D++){var C=l[D],T=p[C],M=4*((i-j[C])*a+T);0<=M&&M+3<v&&(y[M]=Math.round(255+y[M]*(1-o)))}return u.putImageData(O,e,t,b,b,a-2*b,i-2*b),x},f.select=function(e,t,a,i,s,r,n,c){for(var o=[],l=n[s],h=n[r],d=l.length,u=Math.floor(Math.min(c.x,c.x+c.width)-e),b=Math.floor(Math.max(c.x,c.x+c.width)-e),f=i-Math.floor(Math.max(c.y,c.y+c.height)-t),p=i-Math.floor(Math.min(c.y,c.y+c.height)-t),j=0;j<d;j++){var g=l[j],m=h[j];u<=g&&g<b&&f<m&&m<=p&&o.push(j)}return o};var p=f,j=(a(137),a(0)),g=function e(t){var a=Object(i.useRef)(),s=t.nData,r=t.opacity,n=200,o=200,h=d.getColumnNames().length,u=d.getValues(s),b=h*n,f=h*o;e.scaled=[];for(var g=[],m=0;m<h;m++){e.scaled[m]=new Uint16Array(s);var v=m*n;g[m]=l.g().domain(d.getDomain(s,m)).range([v+p.padding,v+n-p.padding])}return u.forEach((function(t,a){for(var i=0;i<h;i++){var s=i*n;e.scaled[i][a]=Math.round(g[i](t[i])-s)}})),Object(i.useEffect)((function(){e.canvas=l.h(a.current.childNodes[0]).node();var t=l.h(a.current.childNodes[1]);t.selectAll("*").remove();var i=t.append("g").selectAll("g").data(l.b(l.f(h),l.f(h))).join("g").attr("transform",(function(e){var t=Object(c.a)(e,2),a=t[0],i=t[1];return"translate(".concat(a*n,",").concat(i*o,")")})),u=function(e,t){var a;return function(){for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];clearTimeout(a),a=setTimeout((function(){clearTimeout(a),e.apply(void 0,s)}),t)}}(e.draw,1),b=l.a().extent([[2,2],[n,o]]).on("start",(function(t){if(t.sourceEvent){var a=t.sourceEvent.target.parentNode;if(e.brushNode!==a)l.h(e.brushNode).call(b.move,null),e.brushNode=a,d.deselectAll();else if(t.selection){var i,s,r=t.selection[0][0],c=t.selection[0][1],h=t.selection[1][0],u=t.selection[1][1];if(t.sourceEvent.touches){var f=t.sourceEvent.touches[0];i=f.clientX-e.canvas.getBoundingClientRect().x,s=f.clientY-e.canvas.getBoundingClientRect().y}else i=t.sourceEvent.offsetX,s=t.sourceEvent.offsetY;var j=Math.floor(i/n),g=Math.floor(s/o),m=j*n,v=g*o;p.isWithin({x:i,y:s},{x:m+r,y:v+c,width:h-r,height:u-c})||d.deselectAll()}}})).on("brush",(function(t){if(t.selection){var i,c,l=t.selection[0][0],h=t.selection[0][1],b=t.selection[1][0],f=t.selection[1][1];if(t.sourceEvent)if(t.sourceEvent.touches){var j=t.sourceEvent.touches[0];i=j.clientX-e.canvas.getBoundingClientRect().x,c=j.clientY-e.canvas.getBoundingClientRect().y}else i=t.sourceEvent.offsetX,c=t.sourceEvent.offsetY;else i=n*Math.floor(1),c=0;var g=Math.floor(i/n),m=Math.floor(c/o),v=g*n,x=m*o;g===m?d.deselectAll():(d.selectedRows=p.select(v,x,n,o,g,m,e.scaled,{x:v+l,y:x+h,width:b-l,height:f-h}),e.bitmaps&&e.bitmaps[g]&&p.draw(v,x,n,o,g,m,e.scaled,a.current.firstChild,r,d.selectedRows,e.bitmaps[g][m]))}u(n,o,a,s,r,!1)})).on("end",(function(t){e.draw(n,o,a,s,r,!0)}));i.call(b),e.brushNode=t.node().firstChild.childNodes[4],l.h(e.brushNode).call(b.move,[[40,40],[80,80]])})),Object(j.jsxs)("div",{ref:a,children:[Object(j.jsx)("canvas",{width:b,height:f}),Object(j.jsx)("svg",{width:b,height:f})]})};g.bitmaps=void 0,g.canvas=void 0,g.brushNode=void 0,g.scaled=void 0,g.clear=function(){d.deselectAll(),g.bitmaps=void 0},g.draw=function(e,t,a,i,s,r){if(a){var n=a.current.firstChild,c=n.getContext("2d"),o=d.getColumnNames().length;if(c){if(r){c.clearRect(0,0,o*e,o*t),c.strokeStyle="#939ba1";for(var l=1;l<o;l++)c.moveTo(l*e+.5,0),c.lineTo(l*e+.5,o*t),c.moveTo(0,l*t+.5),c.lineTo(o*e,l*t+.5);c.stroke()}var h=!g.bitmaps;h&&(g.bitmaps=[]);for(var u=0;u<o;u++)for(var f=0;f<o;f++){var j=u*e,m=f*t;u===f?r&&b.draw(j,m,e,t,n,i,u):h?(void 0===g.bitmaps[u]&&(g.bitmaps[u]=[]),g.bitmaps[u][f]=p.draw(j,m,e,t,u,f,g.scaled,n,s,d.selectedRows)):p.draw(j,m,e,t,u,f,g.scaled,n,s,d.selectedRows,g.bitmaps[u][f])}}}};var m=g,v=(a(139),a.p+"static/media/becker.ed8ef60d.png"),x=a.p+"static/media/cleveland.70d2e3e7.png",w=function e(){var t=Object(i.useState)(e.getPower(14)),a=Object(c.a)(t,2),s=a[0],r=a[1],n=Object(i.useState)(.5),l=Object(c.a)(n,2),h=l[0],d=l[1];return Object(j.jsxs)("div",{className:"Column",children:[Object(j.jsxs)("div",{className:"Description",children:[Object(j.jsx)("h1",{children:"Optimized Brushing"}),Object(j.jsx)("p",{children:"Brushing is a basic technique of exploratory data analysis, developed in the 1970s and 1980s.  Back then, analysts were happy to brush a few hundred points.  On modern hardware, we can brush many more."}),Object(j.jsx)("p",{children:"Drag the brush to select the points.  Drag the edges to resize the brush.  Drag a rectangle in any plot to create a new brush."}),Object(j.jsx)("p",{children:"Use the sliders to adjust the number of points and their transparency."}),Object(j.jsx)(m,{nData:s,opacity:h}),Object(j.jsx)("br",{})]}),Object(j.jsxs)("div",{className:"GridControls",children:[Object(j.jsx)("label",{children:"Points per Plot:"}),Object(j.jsx)(o.a,{defaultValue:14,step:1,min:9,max:18,valueLabelDisplay:"auto",marks:!0,valueLabelFormat:function(t){var a=e.getPower(t);return a>=1e6?a=a/1e6+"M":a>=1e3&&(a=a/1e3+"K"),a},onChange:function(t,a){m.clear(),r(e.getPower(a))}}),Object(j.jsx)("span",{}),Object(j.jsx)("label",{children:"Transparency:"}),Object(j.jsx)(o.a,{defaultValue:.5,step:.01,min:0,max:.99,valueLabelDisplay:"auto",onChange:function(e,t){m.clear(),d(1-t)}})]}),Object(j.jsxs)("div",{className:"Description",children:[Object(j.jsx)("h2",{children:"Design Notes"}),Object(j.jsxs)("p",{className:"center",children:[Object(j.jsx)("a",{href:"https://www.datavis.ca/milestones/index.php?group=1975%2B&mid=ms259",children:Object(j.jsx)("img",{title:"Dr. Richard Becker",alt:"Dr. Richard Becker",src:v})}),"\xa0\xa0\xa0\xa0\xa0",Object(j.jsx)("a",{href:"https://www.datavis.ca/milestones/index.php?group=1975%2B&mid=ms259",children:Object(j.jsx)("img",{title:"Dr. William Cleveland",alt:"Dr. William Cleveland",src:x})}),Object(j.jsx)("br",{})]}),Object(j.jsxs)("p",{children:["This design derives from the ",Object(j.jsx)("a",{href:"http://www.sci.utah.edu/~kpotter/Library/Papers/becker:1987:BS/index.html",children:"scatter plot matrix"})," of ",Object(j.jsx)("a",{href:"https://www.researchgate.net/scientific-contributions/Richard-A-Becker-7076158",children:"Richard Becker"})," and ",Object(j.jsx)("a",{href:"https://www.cerias.purdue.edu/site/people/faculty/view/709",children:"William Cleveland"})," (Becker and Cleveland, 1987).  The implementation uses code from the ",Object(j.jsx)("a",{href:"https://observablehq.com/collection/@d3/d3-brush",children:"d3-brush collection"}),"."]}),Object(j.jsx)("p",{children:'The goal of the scatter plot matrix is not to locate points, but to find patterns in the data.  Therefore, there are no axes, only data ranges.  This increases Tufte\'s "Data-Ink Ratio" (Tufte, 1983).'}),Object(j.jsx)("p",{children:"Colors emphasize the data.   Black on white gives maximum emphasis.  The red selection color draws attention.  The grid, being less important, is gray."}),Object(j.jsx)("p",{children:"For the same reason, the brush could be gray.  However, usability tests pointed out that blue is the standard selection color (Ho, 2016).  Following standards eases the user's learning curve."}),Object(j.jsxs)("p",{children:[Object(j.jsx)("a",{href:"https://github.com/d3/d3-brush",children:"D3's brush"})," is ",Object(j.jsx)("em",{children:"persistent"})," rather than ",Object(j.jsx)("em",{children:"transient"}),".  A persistent brush reduces errors, by enabling the user to resize the brush (Tidwell, 2010).  A persistent brush also helps users share their explorations, through screen shots for example."]}),Object(j.jsxs)("p",{children:["Transparency shows density, via ",Object(j.jsx)("a",{href:"https://en.wikipedia.org/wiki/Alpha_compositing",children:"alpha blending"}),".  This gives scatter plots the expressive power of contour plots, while still displaying individual points (Wegman and Luo, 2002)."]}),Object(j.jsxs)("p",{children:["Optimization was a joint effort with ",Object(j.jsx)("a",{href:"https://observablehq.com/@fil",children:"Fil"}),", whose suggestions made this much faster.  There are a number of small optimizations, but these had the greatest effect:"]}),Object(j.jsxs)("ol",{children:[Object(j.jsx)("li",{children:"Drawing in a single CANVAS eliminates the need to allocate thousands of SVG elements."}),Object(j.jsx)("li",{children:"Drawing each row of data as a single pixel displays large data sets with minimal drawing code."}),Object(j.jsxs)("li",{children:["Deselected points are cached in bitmaps, so that drawing a plot requires only a fast ",Object(j.jsx)("a",{href:"https://en.wikipedia.org/wiki/Bit_blit",children:"bit blit"}),", then drawing the selected points."]}),Object(j.jsx)("li",{children:"Pixel coordinates are cached in integer Arrays, to eliminate scaling calculations during drawing and selection."}),Object(j.jsxs)("li",{children:["The brushing interaction is ",Object(j.jsx)("a",{href:"https://levelup.gitconnected.com/debounce-in-javascript-improve-your-applications-performance-5b01855e086",children:"debounced"}),", to reduce drawing in large data sets."]})]}),Object(j.jsx)("p",{children:"Performance varies on different devices.  My iMac can brush 1,000,000 points per plot; in a 4x4 matrix, that's twelve million points.  As our hardware improves, we'll see these numbers grow."}),Object(j.jsx)("br",{}),Object(j.jsx)("h2",{children:"References"}),Object(j.jsxs)("ul",{children:[Object(j.jsxs)("li",{children:['Becker, R. and Cleveland, W. (1987). "Brushing Scatterplots". Technometrics. 29 (2): 127-142. ',Object(j.jsx)("a",{href:"https://doi.org/10.2307/1269768",children:"https://doi.org/10.2307/1269768"}),"."]}),Object(j.jsx)("br",{}),Object(j.jsxs)("li",{children:["Ho, Y. (2016). Personal communication. ",Object(j.jsx)("a",{href:"https://www.linkedin.com/in/yang-ho-94b14860/",children:"https://www.linkedin.com/in/yang-ho-94b14860/"})]}),Object(j.jsx)("br",{}),Object(j.jsxs)("li",{children:["Tidwell, J. (2010). Designing Interfaces: Patterns for Effective Interaction Design, Second Edition, 312-314.  Sebastopol CA: O'Reilly Media. ",Object(j.jsx)("a",{href:"https://www.oreilly.com/library/view/designing-interfaces-3rd/9781492051954/",children:"https://www.oreilly.com/library/view/designing-interfaces-3rd/9781492051954/"}),"."]}),Object(j.jsx)("br",{}),Object(j.jsxs)("li",{children:["Tufte, E. (1983). The Visual Display of Quantitative Information, First Edition, 91-105.  Cheshire CN: Graphics Press. ",Object(j.jsx)("a",{href:"https://www.edwardtufte.com/tufte/",children:"https://www.edwardtufte.com/tufte/"}),"."]}),Object(j.jsx)("br",{}),Object(j.jsxs)("li",{children:['Wegman, E. and Luo, Q. (2002). "On Methods of Computer Graphics for Visualizing Densities". Journal of Computational and Graphical Statistics 11, (1), 137-162. ',Object(j.jsx)("a",{href:"https://doi.org/10.1198/106186002317375659",children:"https://doi.org/10.1198/106186002317375659"}),"."]}),Object(j.jsx)("br",{})]})]}),Object(j.jsx)("a",{href:"https://github.com/hemanrobinson/brush/",children:"Code Shared on GitHub"})]})};w.getPower=function(e){return(e%3===0?1:e%3===1?2:5)*Math.pow(10,Math.floor(e/3))};var O=w;n.a.render(Object(j.jsx)(s.a.StrictMode,{children:Object(j.jsx)(O,{})}),document.getElementById("root"))}},[[143,1,2]]]);
//# sourceMappingURL=main.c15c2b8d.chunk.js.map